<section class="space-y-4" aria-labelledby="vocal-detail-title">
  <header class="panel p-5">
    <a [routerLink]="['/app/vocaux']" class="text-sm font-medium text-slate-600 transition hover:text-blue-700">
      ← Retour à la liste des vocaux
    </a>

    <h2 id="vocal-detail-title" class="mt-3 text-3xl font-semibold tracking-tight text-slate-900">
      Détail vocal
    </h2>
  </header>

  @if (error()) {
    <p class="rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700" role="status" aria-live="polite">
      {{ error() }}
    </p>
  }

  @if (info()) {
    <p class="rounded-2xl border border-emerald-200 bg-emerald-50 p-4 text-sm text-emerald-700" role="status" aria-live="polite">
      {{ info() }}
    </p>
  }

  @if (loading()) {
    <p class="panel p-4 text-sm text-slate-700">Chargement du vocal...</p>
  } @else if (vocal(); as vocal) {
    <section class="panel space-y-5 p-5">
      <dl class="grid gap-4 text-sm text-slate-700 md:grid-cols-2">
        <div>
          <dt class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Date</dt>
          <dd class="mt-1">{{ vocal.createdAt | date: "full" }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Statut</dt>
          <dd class="mt-1">{{ statusLabel(vocal.status) }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Type</dt>
          <dd class="mt-1">{{ typeLabel(vocal.vocalType) }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Attachement</dt>
          <dd class="mt-1">
            @if (vocal.propertyId) {
              <a [routerLink]="['/app/bien', vocal.propertyId]" class="font-medium text-slate-800 transition hover:text-blue-700">
                Voir bien
              </a>
            } @else {
              <span class="text-slate-500">Non rattaché</span>
            }
          </dd>
        </div>
      </dl>

      <div class="space-y-2">
        <p class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Audio</p>
        @if (audioUrl(); as url) {
          <audio controls preload="none" class="h-10 w-full max-w-xl">
            <source [src]="url" />
            Votre navigateur ne supporte pas l'audio.
          </audio>
        } @else {
          <p class="text-sm text-slate-500">Audio indisponible</p>
        }
      </div>

      @if (vocal.processingError) {
        <div class="rounded-2xl border border-amber-300 bg-amber-50 p-4">
          <p class="text-xs font-semibold uppercase tracking-[0.12em] text-amber-700">Erreur de traitement</p>
          <p class="mt-1 text-sm text-amber-800">{{ vocal.processingError }}</p>
          <button
            type="button"
            class="mt-3 rounded-xl border border-amber-400 bg-white px-3 py-2 text-sm font-semibold text-amber-800 transition hover:bg-amber-100 disabled:cursor-not-allowed disabled:opacity-60"
            [disabled]="retrying()"
            (click)="retryTranscription()"
          >
            {{ retrying() ? "Relance en cours..." : "Relancer la transcription" }}
          </button>
        </div>
      } @else if (canRetry()) {
        <button
          type="button"
          class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-60"
          [disabled]="retrying()"
          (click)="retryTranscription()"
        >
          {{ retrying() ? "Relance en cours..." : "Relancer la transcription" }}
        </button>
      }

      <div class="space-y-2">
        <p class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Transcription complète</p>
        <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-800">
          <p class="whitespace-pre-wrap">{{ vocal.transcript || "Transcription en attente" }}</p>
        </div>
      </div>

      @if (vocal.summary) {
        <div class="space-y-2">
          <p class="text-xs font-semibold uppercase tracking-[0.12em] text-slate-500">Résumé</p>
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-800">
            <p class="whitespace-pre-wrap">{{ vocal.summary }}</p>
          </div>
        </div>
      }
    </section>
  }
</section>
