<section class="space-y-4" aria-labelledby="vocals-title">
  <header class="panel p-5">
    <div class="flex flex-wrap items-start justify-between gap-3">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-blue-600">Activite vocale</p>
        <h2 id="vocals-title" class="mt-2 text-3xl font-semibold tracking-tight text-slate-900">
          Vocaux
        </h2>
        <p class="mt-1 text-sm text-slate-500">{{ vocalsCount() }} vocal(aux)</p>
      </div>

      <button
        type="button"
        class="rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100"
        (click)="loadVocals()"
      >
        Rafraichir
      </button>
    </div>
  </header>

  @if (error()) {
    <p class="rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700" role="status" aria-live="polite">
      {{ error() }}
    </p>
  }

  @if (loading()) {
    <p class="panel p-4 text-sm text-slate-700" role="status" aria-live="polite">
      Chargement des vocaux...
    </p>
  } @else if (vocals().length === 0) {
    <p class="panel p-4 text-sm text-slate-600">Aucun vocal disponible.</p>
  } @else {
    <section class="panel overflow-x-auto p-0">
      <table class="min-w-full border-collapse text-sm">
        <thead class="bg-slate-100 text-left text-xs font-semibold uppercase tracking-[0.12em] text-slate-600">
          <tr>
            <th class="px-4 py-3">Date</th>
            <th class="px-4 py-3">Type vocal</th>
            <th class="px-4 py-3">Lecteur audio</th>
            <th class="px-4 py-3">Attachement</th>
            <th class="px-4 py-3">Transcription</th>
          </tr>
        </thead>
        <tbody>
          @for (vocal of vocals(); track vocal.id) {
            <tr class="border-t border-slate-200 align-top">
              <td class="px-4 py-3 text-slate-700">
                <a [routerLink]="['/app/vocaux', vocal.id]" class="font-medium text-slate-800 transition hover:text-blue-700">
                  {{ vocal.createdAt | date: "short" }}
                </a>
              </td>
              <td class="px-4 py-3 text-slate-700">{{ typeLabel(vocal.vocalType) }}</td>
              <td class="px-4 py-3">
                @if (audioUrl(vocal.id); as url) {
                  @if (url) {
                    <audio controls preload="none" class="h-9 w-56">
                      <source [src]="url" />
                      Votre navigateur ne supporte pas l'audio.
                    </audio>
                  } @else {
                    <span class="text-slate-500">Audio indisponible</span>
                  }
                } @else {
                  <span class="text-slate-500">Audio en attente</span>
                }
              </td>
              <td class="px-4 py-3">
                @if (vocal.propertyId) {
                  <a [routerLink]="['/app/bien', vocal.propertyId]" class="text-slate-800 transition hover:text-blue-700">
                    Voir bien
                  </a>
                } @else {
                  <span class="text-slate-500">Non rattache</span>
                }
              </td>
              <td class="px-4 py-3">
                <p class="max-w-md truncate text-slate-700" [title]="vocal.transcript || ''">
                  {{ vocal.transcript || "Transcription en attente" }}
                </p>
                @if (vocal.processingError) {
                  <p class="mt-1 max-w-md truncate text-xs text-red-600" [title]="vocal.processingError">
                    {{ vocal.processingError }}
                  </p>
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </section>
  }
</section>
