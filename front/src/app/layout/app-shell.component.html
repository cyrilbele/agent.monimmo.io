<div class="flex min-h-screen bg-slate-100 text-slate-900">
  @if (mobileNavOpen()) {
    <button
      type="button"
      class="fixed inset-0 z-30 bg-slate-950/45 lg:hidden"
      aria-label="Fermer le menu"
      (click)="closeMobileNav()"
    ></button>
  }

  <aside
    id="app-primary-nav"
    class="fixed inset-y-0 left-0 z-40 flex w-72 shrink-0 -translate-x-full flex-col border-r border-slate-200 bg-white transition-transform duration-200 ease-out lg:static lg:z-auto lg:translate-x-0"
    [class.translate-x-0]="mobileNavOpen()"
  >
    <div class="border-b border-slate-200 px-6 py-6">
      <p class="text-3xl font-serif leading-none">monimmo.io</p>
      <p class="mt-1 text-sm text-slate-500">OutilsPro</p>
    </div>

    <nav class="flex-1 px-3 py-4" aria-label="Navigation principale">
      <div class="space-y-1">
        @for (item of primaryNav; track item.label) {
          <a
            [routerLink]="item.route"
            routerLinkActive="bg-blue-100 text-blue-700"
            ariaCurrentWhenActive="page"
            class="flex items-center rounded-xl px-3 py-2.5 text-base font-medium text-slate-600 transition hover:bg-slate-100"
            (click)="onNavLinkClick()"
          >
            {{ item.label }}
          </a>
        }
      </div>
    </nav>

    <div class="border-t border-slate-200 p-4">
      <p class="text-sm font-semibold text-slate-800">{{ authService.userEmail() || "agent connecté" }}</p>
      <button
        type="button"
        class="mt-3 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100"
        [disabled]="loggingOut()"
        (click)="logout()"
        [attr.aria-busy]="loggingOut() ? 'true' : 'false'"
      >
        {{ loggingOut() ? "Déconnexion..." : "Se déconnecter" }}
      </button>
    </div>
  </aside>

  <section class="flex min-w-0 flex-1 flex-col">
    <a
      href="#main-content"
      class="sr-only rounded-lg bg-white px-3 py-2 font-semibold text-slate-900 focus:not-sr-only focus:absolute focus:left-4 focus:top-4"
    >
      Aller au contenu principal
    </a>

    <header class="sticky top-0 z-20 border-b border-slate-200 bg-white/95 backdrop-blur">
      <div class="flex items-center justify-between gap-3 px-4 py-3 sm:px-6 lg:px-8">
        <div class="flex min-w-0 items-center gap-3">
          <button
            type="button"
            class="inline-flex h-10 w-10 shrink-0 items-center justify-center rounded-xl border border-slate-300 bg-white text-slate-700 transition hover:bg-slate-100 lg:hidden"
            aria-controls="app-primary-nav"
            [attr.aria-expanded]="mobileNavOpen() ? 'true' : 'false'"
            aria-label="Ouvrir le menu"
            (click)="toggleMobileNav()"
          >
            <svg viewBox="0 0 24 24" aria-hidden="true" class="h-5 w-5">
              <path
                d="M4 7h16M4 12h16M4 17h16"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                fill="none"
              />
            </svg>
          </button>

          @if (breadcrumbs(); as crumbs) {
            <nav aria-label="Fil d'Ariane" class="min-w-0">
              <ol class="flex min-w-0 items-center gap-1 text-sm font-medium text-slate-500">
                @for (breadcrumb of crumbs; track $index) {
                  <li class="min-w-0">
                    @if (breadcrumb.route && !$last) {
                      <a
                        [routerLink]="breadcrumb.route"
                        class="truncate rounded-md px-1 py-0.5 text-slate-600 transition hover:bg-slate-100 hover:text-slate-900"
                      >
                        {{ breadcrumb.label }}
                      </a>
                    } @else {
                      <span class="truncate px-1 py-0.5" [class.text-slate-900]="$last">
                        {{ breadcrumb.label }}
                      </span>
                    }
                  </li>

                  @if (!$last) {
                    <li aria-hidden="true" class="text-slate-400">›</li>
                  }
                }
              </ol>
            </nav>
          }
        </div>

        <a
          routerLink="/app/bien/nouveau"
          class="inline-flex shrink-0 items-center rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white transition hover:bg-blue-700"
        >
          Nouveau dossier
        </a>
      </div>
    </header>

    <main id="main-content" tabindex="-1" class="min-h-0 flex-1 overflow-auto">
      <div [class]="contentWrapperClass()">
        <router-outlet></router-outlet>
      </div>
    </main>
  </section>
</div>
