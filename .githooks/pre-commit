#!/usr/bin/env bash
set -euo pipefail

if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
  exit 0
fi

if ! git diff --quiet --ignore-submodules --; then
  echo "Commit blocked: unstaged changes detected."
  echo "Stage or discard all changes before committing."
  git status --short
  exit 1
fi

if [[ -n "$(git ls-files --others --exclude-standard)" ]]; then
  echo "Commit blocked: untracked files detected."
  echo "Stage or remove all untracked files before committing."
  git status --short
  exit 1
fi

exit 0
